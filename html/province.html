<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <title>疫情统计曲线图</title>
    <script src="../js/jquery.js"></script>
    <script src="../js/echarts.js"></script>
    <script src="../js/logData.js"></script>
    <script src="../js/utils.js"></script>
</head>

<body>
    <!--为echarts准备一个容器，画图就画在里面-->
    <div id="box" style="width: 800px;height: 600px;"></div>
    <input type="radio" name="type" id="type-infected" value="1"><label for="type-infected">新增/累计感染</label>
    <input type="radio" name="type" id="type-death-cure" value="2"><label for="type-death-cure">累计死亡/治愈</label>
    <script>
        const params = new URLSearchParams(location.search)
        let province = params.get('province') || '全国'
        
        $('input[name="type"]').change(e => {
            myChart.showLoading()
            console.log(e);
            
            let data = [], legend = []
            if (e.target.value == 1) {
                data = [{
                    name: '新增确诊',
                    type: 'line',
                    data: augmentInfectedRecord
                }, {
                    name: '累计确诊',
                    type: 'line',
                    data: aggregateInfectedRecord
                }]
                legend = ['新增确诊', '累计确诊']
            } else {
                data = [{
                    name: '累计治愈',
                    type: 'line',
                    data: aggregateCureRecord
                }, {
                    name: '累计死亡',
                    type: 'line',
                    data: aggregateDeathRecord  
                }]
                legend = ['累计治愈', '累计死亡']
            }
            option.legend.data = legend
            option.series = data
            myChart.setOption(option, true)
            setTimeout(() => {
                myChart.hideLoading()
            }, 500);
        })


        const augmentInfectedRecord = getStatisticData(2, 'infected', province)
        const aggregateInfectedRecord = getStatisticData(1, 'infected', province)
        const aggregateCureRecord = getStatisticData(1, 'cure', province)
        const aggregateDeathRecord = getStatisticData(1, 'death', province)
        console.log(augmentInfectedRecord, aggregateInfectedRecord, aggregateDeathRecord, aggregateCureRecord)
            //初始化ehcharts实例
        var myChart = echarts.init(document.getElementById("box"));
        //指定图表的配置项和数据
        var option = {
            //标题
            title: {
                text: province + '疫情统计'
            },
            //工具箱
            //保存图片
            toolbox: {
                show: true,
                feature: {
                    saveAsImage: {
                        show: true
                    }
                }
            },
            //悬浮显示数据
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross',
                    crossStyle: {
                        color: '#999'
                    }
                },
                formatter: function(params) {
                    let firstParams = params[0];
                    return firstParams.name + '<br>' + firstParams.seriesName + '  ' + firstParams.data;
                }
            },
            //图例-每一条数据的名字叫销量
            legend: {
                data: ['新增确诊', '累计确诊', '累计治愈', '累计死亡'],
                // selectedMode: 'single',
            },
            //x轴
            xAxis: {
                data: ["01.19", "01.20", "01.21", "01.22", "01.23", "01.24", "01.25", "01.26", "01.27", "01.28", "01.29", "01.30", "01.31", "02.01", "02.02"]
            },
            //y轴没有显式设置，根据值自动生成y轴
            yAxis: {},
            //数据-data是最终要显示的数据
            series: [{
                    name: '新增确诊',
                    type: 'line',
                    data: augmentInfectedRecord
                }, {
                    name: '累计确诊',
                    type: 'line',
                    data: aggregateInfectedRecord
                }, {
                    name: '累计治愈',
                    type: 'line',
                    data: aggregateCureRecord
                }, {
                    name: '累计死亡',
                    type: 'line',
                    data: aggregateDeathRecord
                }

            ]
        };
        //使用刚刚指定的配置项和数据项显示图表
        myChart.setOption(option);
        window.o = option
    </script>
</body>

</html>